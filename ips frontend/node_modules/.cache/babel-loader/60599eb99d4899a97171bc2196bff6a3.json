{"ast":null,"code":"var _jsxFileName = \"/home/gungorerhan/Dev/bluetooth-localization/ips frontend/src/components/Usertrace.js\";\nimport React, { Component } from 'react';\nimport './Usertrace.css';\nimport UsertraceDots from './UsertraceDots';\nimport axios from 'axios';\nimport UsertraceLines from './UsertraceLines';\n\nclass Usertrace extends Component {\n  constructor(...args) {\n    super(...args);\n    this.state = {\n      persons: [],\n      filtered_persons: [],\n      positions: [],\n      line_positions: []\n    };\n\n    this.filter_positions = () => {\n      var length = this.state.positions.length;\n\n      for (var i = 0; i < length; i++) {\n        var x_pos = this.state.positions[i].x_position;\n        var y_pos = this.state.positions[i].y_position;\n\n        for (var j = i + 1; j < length; j++) {\n          var distance = Math.pow(x_pos - this.state.positions[j].x_position, 2) + Math.pow(y_pos - this.state.positions[j].y_position, 2);\n          distance = Math.sqrt(distance);\n\n          if (distance < 0.3) {\n            this.state.positions[j].date = \"0\";\n          }\n        }\n      }\n\n      this.setState({\n        positions: this.state.positions.filter(function (position) {\n          return position.date !== \"0\";\n        })\n      });\n    };\n\n    this.get_positions = () => {\n      if (document.getElementById(\"begin_date\").value === '' || document.getElementById(\"begin_hour\").value === '' || document.getElementById(\"end_date\").value === '' || document.getElementById(\"end_hour\").value === '') {} else {\n        if (document.getElementById(\"begin_date\").value == document.getElementById(\"end_date\").value) {\n          var begin_date = document.getElementById(\"begin_date\").value + \" \" + document.getElementById(\"begin_hour\").value + \":00\";\n          var end_date = document.getElementById(\"end_date\").value + \" \" + document.getElementById(\"end_hour\").value + \":00\";\n\n          if (end_date > begin_date) {\n            document.getElementById(\"begin_p_tag\").innerHTML = \"Begin date: \" + begin_date;\n            document.getElementById(\"end_p_tag\").innerHTML = \"End date: \" + end_date;\n            var e = document.getElementById(\"person_select\");\n            var id = e.options[e.selectedIndex].value;\n            document.getElementById(\"person_p_tag\").innerHTML = \"Person: \" + e.options[e.selectedIndex].innerHTML;\n            var url = 'https://t7ftvwr8bi.execute-api.eu-central-1.amazonaws.com/cors/position/person-trace?personId=\"';\n            url = url + id + '\"';\n            url = url + '&startTime=\"' + begin_date + '\"';\n            url = url + '&endTime=\"' + end_date + '\"';\n            axios.get(url).then(res => {\n              const data = res.data;\n              var keys = Object.keys(data);\n              var values = Object.values(data);\n              let temp_positions = [];\n\n              for (var i = 0; i < keys.length; i++) {\n                var position = {\n                  date: keys[i],\n                  x_position: values[i].x,\n                  y_position: values[i].y,\n                  condition: \"no_show_info\"\n                };\n                let positions = [...temp_positions, position];\n                temp_positions = positions;\n              }\n\n              this.setState({\n                positions: temp_positions\n              });\n              this.filter_positions();\n              this.adjust_line_positions();\n            });\n          }\n        }\n      }\n    };\n\n    this.handle_filter_person = () => {\n      var input_value = document.getElementById(\"search_input\").value;\n\n      if (input_value === \"\") {\n        this.setState({\n          filtered_persons: this.state.persons\n        });\n      } else {\n        this.setState({\n          filtered_persons: this.state.persons.filter(function (person) {\n            var full_name = person.first_name + \" \" + person.last_name;\n            return person.person_id == input_value || person.first_name.toLowerCase() == input_value.toLowerCase() || person.last_name.toLowerCase() == input_value.toLowerCase() || full_name.toLowerCase() == input_value.toLowerCase();\n          })\n        });\n      }\n    };\n\n    this.add_persons = () => {\n      var person_select = document.getElementById('person_select');\n      person_select.innerHTML = \"\";\n      var length = this.state.filtered_persons.length;\n\n      for (let i = 0; i < length; i++) {\n        let text = this.state.filtered_persons[i].person_id + \" - \" + this.state.filtered_persons[i].first_name + \" \" + this.state.filtered_persons[i].last_name;\n        person_select.options[person_select.options.length] = new Option(text, this.state.filtered_persons[i].person_id);\n      }\n    };\n\n    this.show_info = id => {\n      document.getElementById(id).className = 'show_info';\n    };\n\n    this.hide_info = id => {\n      document.getElementById(id).className = 'no_show_info';\n    };\n  }\n\n  componentDidUpdate() {\n    this.add_persons();\n  }\n\n  componentDidMount() {\n    this.get_persons();\n    this.filter_positions();\n  } // filter positions  inside 0.3 m near\n\n\n  // generate lines begin and end positions\n  adjust_line_positions() {\n    var length = this.state.positions.length - 1;\n    let temp_line_positions = [];\n\n    for (var i = 0; i < length; i++) {\n      var line_position = {\n        start_x: this.state.positions[i].x_position,\n        start_y: this.state.positions[i].y_position,\n        end_x: this.state.positions[i + 1].x_position,\n        end_y: this.state.positions[i + 1].y_position\n      };\n      let line_positions = [...temp_line_positions, line_position];\n      temp_line_positions = line_positions;\n    }\n\n    this.setState({\n      line_positions: temp_line_positions\n    });\n  } // get locations from server\n\n\n  // get persons from server\n  get_persons() {\n    axios.get(`https://t7ftvwr8bi.execute-api.eu-central-1.amazonaws.com/cors/person`).then(res => {\n      const data = res.data;\n      var keys = Object.keys(data);\n      var values = Object.values(data);\n      let temp_persons = [];\n\n      for (var i = 0; i < keys.length; i++) {\n        var person = {\n          person_id: keys[i],\n          first_name: values[i].firstName,\n          last_name: values[i].lastName,\n          card_id: values[i].cardId\n        };\n        let persons = [...temp_persons, person];\n        temp_persons = persons;\n      }\n\n      this.setState({\n        persons: temp_persons\n      });\n      this.handle_filter_person();\n    });\n  } // search person by name or person id\n\n\n  render() {\n    return React.createElement(\"div\", {\n      id: \"usertrace_container\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 209\n      },\n      __self: this\n    }, React.createElement(\"div\", {\n      id: \"user_trace_menu\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 210\n      },\n      __self: this\n    }, React.createElement(\"h2\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 211\n      },\n      __self: this\n    }, \"select person\"), React.createElement(\"div\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 212\n      },\n      __self: this\n    }, React.createElement(\"p\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 213\n      },\n      __self: this\n    }, \"search:\"), React.createElement(\"input\", {\n      id: \"search_input\",\n      className: \"text\",\n      onChange: this.handle_filter_person,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 214\n      },\n      __self: this\n    })), React.createElement(\"div\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 216\n      },\n      __self: this\n    }, React.createElement(\"p\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 217\n      },\n      __self: this\n    }, \"person:\"), React.createElement(\"select\", {\n      id: \"person_select\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 218\n      },\n      __self: this\n    })), React.createElement(\"h2\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 220\n      },\n      __self: this\n    }, \"begin time\"), React.createElement(\"div\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 221\n      },\n      __self: this\n    }, React.createElement(\"p\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 222\n      },\n      __self: this\n    }, \"date:\"), React.createElement(\"input\", {\n      id: \"begin_date\",\n      type: \"date\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 223\n      },\n      __self: this\n    })), React.createElement(\"div\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 225\n      },\n      __self: this\n    }, React.createElement(\"p\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 226\n      },\n      __self: this\n    }, \"hour:\"), React.createElement(\"input\", {\n      id: \"begin_hour\",\n      type: \"time\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 227\n      },\n      __self: this\n    })), React.createElement(\"h2\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 229\n      },\n      __self: this\n    }, \"end time\"), React.createElement(\"div\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 230\n      },\n      __self: this\n    }, React.createElement(\"p\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 231\n      },\n      __self: this\n    }, \"date:\"), React.createElement(\"input\", {\n      id: \"end_date\",\n      type: \"date\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 232\n      },\n      __self: this\n    })), React.createElement(\"div\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 234\n      },\n      __self: this\n    }, React.createElement(\"p\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 235\n      },\n      __self: this\n    }, \"hour:\"), React.createElement(\"input\", {\n      id: \"end_hour\",\n      type: \"time\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 236\n      },\n      __self: this\n    })), React.createElement(\"input\", {\n      className: \"usertrace_submit\",\n      type: \"submit\",\n      value: \"Show\",\n      onClick: this.get_positions,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 238\n      },\n      __self: this\n    })), React.createElement(\"div\", {\n      id: \"usertrace_show\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 240\n      },\n      __self: this\n    }, React.createElement(\"h1\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 241\n      },\n      __self: this\n    }, \"User Trace\"), React.createElement(\"p\", {\n      id: \"person_p_tag\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 242\n      },\n      __self: this\n    }), React.createElement(\"p\", {\n      id: \"begin_p_tag\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 243\n      },\n      __self: this\n    }), React.createElement(\"p\", {\n      id: \"end_p_tag\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 244\n      },\n      __self: this\n    }), React.createElement(\"div\", {\n      id: \"usertrace_floor_plan\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 245\n      },\n      __self: this\n    }, React.createElement(UsertraceDots, {\n      positions: this.state.positions,\n      show_info: this.show_info,\n      hide_info: this.hide_info,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 246\n      },\n      __self: this\n    }), React.createElement(UsertraceLines, {\n      line_positions: this.state.line_positions,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 247\n      },\n      __self: this\n    }))));\n  }\n\n}\n\nexport default Usertrace;","map":{"version":3,"sources":["/home/gungorerhan/Dev/bluetooth-localization/ips frontend/src/components/Usertrace.js"],"names":["React","Component","UsertraceDots","axios","UsertraceLines","Usertrace","state","persons","filtered_persons","positions","line_positions","filter_positions","length","i","x_pos","x_position","y_pos","y_position","j","distance","Math","pow","sqrt","date","setState","filter","position","get_positions","document","getElementById","value","begin_date","end_date","innerHTML","e","id","options","selectedIndex","url","get","then","res","data","keys","Object","values","temp_positions","x","y","condition","adjust_line_positions","handle_filter_person","input_value","person","full_name","first_name","last_name","person_id","toLowerCase","add_persons","person_select","text","Option","show_info","className","hide_info","componentDidUpdate","componentDidMount","get_persons","temp_line_positions","line_position","start_x","start_y","end_x","end_y","temp_persons","firstName","lastName","card_id","cardId","render"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\nimport './Usertrace.css';\nimport UsertraceDots from './UsertraceDots';\nimport axios from 'axios';\nimport UsertraceLines from './UsertraceLines';\n\n\n\nclass Usertrace extends Component {\n    state = {\n        persons: [],\n        filtered_persons: [],\n        positions: [],\n        line_positions:[]\n    }\n    componentDidUpdate(){\n        this.add_persons();\n    }\n    componentDidMount(){\n        this.get_persons();\n        this.filter_positions();\n        \n    }\n    \n\n    // filter positions  inside 0.3 m near\n    filter_positions = () =>{\n        var length = this.state.positions.length;\n\n        for( var i = 0; i < length; i++){\n            var x_pos = this.state.positions[i].x_position;\n            var y_pos = this.state.positions[i].y_position;\n            for (var j = i+1; j<length; j++){\n                var distance = Math.pow(x_pos-this.state.positions[j].x_position,2) +\n                                Math.pow(y_pos-this.state.positions[j].y_position,2);\n                \n                distance = Math.sqrt(distance);\n                \n                if(distance < 0.3){\n                    this.state.positions[j].date = \"0\";\n                }\n            }\n        }\n\n        this.setState({\n            positions: this.state.positions.filter(function(position){\n                return position.date !== \"0\";\n            })\n        })\n    }\n\n    // generate lines begin and end positions\n    adjust_line_positions(){\n        var length = this.state.positions.length - 1;\n        \n        let temp_line_positions = [];\n\n        for( var i = 0; i < length; i++){\n                \n            var line_position = {\n                start_x: this.state.positions[i].x_position,\n                start_y: this.state.positions[i].y_position,\n                end_x: this.state.positions[i+1].x_position,\n                end_y: this.state.positions[i+1].y_position\n            }\n            let line_positions = [...temp_line_positions, line_position];\n            temp_line_positions = line_positions;\n        \n\n            \n        } \n        \n        this.setState({\n            line_positions: temp_line_positions\n        });\n\n    }\n\n    // get locations from server\n    get_positions = () =>{\n        if(document.getElementById(\"begin_date\").value === ''\n            || document.getElementById(\"begin_hour\").value === ''\n            || document.getElementById(\"end_date\").value === ''\n            || document.getElementById(\"end_hour\").value === ''){\n        }\n        else{\n            if( document.getElementById(\"begin_date\").value == document.getElementById(\"end_date\").value){\n                var begin_date = document.getElementById(\"begin_date\").value + \" \" \n                    + document.getElementById(\"begin_hour\").value + \":00\";\n\n                var end_date = document.getElementById(\"end_date\").value + \" \" \n                    + document.getElementById(\"end_hour\").value + \":00\";\n\n                if(end_date > begin_date){\n                    document.getElementById(\"begin_p_tag\").innerHTML = \"Begin date: \" + begin_date;\n                    document.getElementById(\"end_p_tag\").innerHTML = \"End date: \" + end_date;\n                    \n\n                    var e = document.getElementById(\"person_select\");\n                    var id = e.options[e.selectedIndex].value;\n\n                    document.getElementById(\"person_p_tag\").innerHTML = \"Person: \" + e.options[e.selectedIndex].innerHTML;\n\n\n                    var url = 'https://t7ftvwr8bi.execute-api.eu-central-1.amazonaws.com/cors/position/person-trace?personId=\"';\n                    url = url + id + '\"';\n                    url = url + '&startTime=\"' + begin_date + '\"';\n                    url = url + '&endTime=\"' + end_date + '\"';\n\n                    axios.get(url)\n                        .then(res => {\n                            const data = res.data;\n                            var keys = Object.keys(data);\n                            var values = Object.values(data);\n                            let temp_positions = [];\n                \n                            for (var i = 0; i < keys.length; i++){\n                                var position = {\n                                    date: keys[i],\n                                    x_position: values[i].x,\n                                    y_position: values[i].y,\n                                    condition: \"no_show_info\"\n                                }\n                                let positions = [...temp_positions, position];\n                                temp_positions = positions;\n                            }\n                \n                            this.setState({\n                                positions: temp_positions\n                            })\n                            this.filter_positions();\n                            this.adjust_line_positions();\n                    });\n                }\n            }\n        }\n    }\n\n    // get persons from server\n    get_persons(){\n        axios.get(`https://t7ftvwr8bi.execute-api.eu-central-1.amazonaws.com/cors/person`)\n            .then(res => {\n            const data = res.data;\n            var keys = Object.keys(data);\n            var values = Object.values(data);\n            let temp_persons = [];\n\n            for (var i = 0; i < keys.length; i++){\n                var person = {\n                    person_id: keys[i],\n                    first_name: values[i].firstName,\n                    last_name: values[i].lastName,\n                    card_id: values[i].cardId\n                }\n                let persons = [...temp_persons, person];\n                temp_persons = persons;\n            }\n\n            this.setState({\n                persons: temp_persons\n            })\n            this.handle_filter_person();\n   \n        })\n    }\n\n    // search person by name or person id\n    handle_filter_person = () => {\n        var input_value = document.getElementById(\"search_input\").value;\n        if( input_value === \"\"){\n            this.setState({filtered_persons: this.state.persons});\n        }\n        else{\n            this.setState({\n                filtered_persons: this.state.persons.filter(function(person){\n                    var full_name = person.first_name + \" \" + person.last_name;\n                    return person.person_id == input_value \n                                || person.first_name.toLowerCase() == input_value.toLowerCase() \n                                || person.last_name.toLowerCase() == input_value.toLowerCase()\n                                || full_name.toLowerCase() == input_value.toLowerCase()\n                })\n            })\n        }\n    }\n\n\n    // add persons to select tag\n    add_persons = () =>{\n        var person_select = document.getElementById('person_select');\n        person_select.innerHTML = \"\";\n        var length = this.state.filtered_persons.length;\n        for(let i = 0; i<length; i++){\n            let text = this.state.filtered_persons[i].person_id + \" - \" \n                      +this.state.filtered_persons[i].first_name + \" \"\n                      +this.state.filtered_persons[i].last_name;     \n            person_select.options[person_select.options.length] = \n                        new Option(text, this.state.filtered_persons[i].person_id);\n        }\n    } \n\n    show_info = (id) => {\n        document.getElementById(id).className = 'show_info'; \n    }\n    hide_info = (id) => {\n        document.getElementById(id).className = 'no_show_info';\n    }   \n    render(){\n        return(\n            <div id=\"usertrace_container\">\n                <div id=\"user_trace_menu\">\n                    <h2>select person</h2>\n                    <div>\n                        <p>search:</p>\n                        <input id=\"search_input\" className=\"text\" onChange={this.handle_filter_person}></input>\n                    </div>\n                    <div>\n                        <p>person:</p>\n                        <select id=\"person_select\"></select>                \n                        </div>\n                    <h2 >begin time</h2>\n                    <div>\n                        <p>date:</p>\n                        <input id=\"begin_date\" type=\"date\"></input>\n                    </div>\n                    <div>\n                        <p>hour:</p>\n                        <input id=\"begin_hour\" type=\"time\"></input>\n                    </div>\n                    <h2 >end time</h2>\n                    <div>\n                        <p>date:</p>\n                        <input id=\"end_date\" type=\"date\"></input>\n                    </div>\n                    <div>\n                        <p>hour:</p>\n                        <input id=\"end_hour\" type=\"time\"></input>\n                    </div>\n                    <input className=\"usertrace_submit\" type=\"submit\" value=\"Show\" onClick={this.get_positions}></input>\n                </div >\n                <div id=\"usertrace_show\">\n                    <h1>User Trace</h1>\n                    <p id=\"person_p_tag\"></p>\n                    <p id=\"begin_p_tag\"></p>\n                    <p id=\"end_p_tag\"></p>\n                    <div id=\"usertrace_floor_plan\">\n                        <UsertraceDots positions = {this.state.positions} show_info={this.show_info} hide_info={this.hide_info}></UsertraceDots>\n                        <UsertraceLines line_positions = {this.state.line_positions}></UsertraceLines>\n                    </div>\n                </div>\n                    \n    \n            </div>\n        )\n    }\n}\n\nexport default Usertrace"]},"metadata":{},"sourceType":"module"}